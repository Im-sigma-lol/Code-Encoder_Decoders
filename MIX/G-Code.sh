#!/data/data/com.termux/files/usr/bin/bash

LUA_DECODER=$(cat <<'EOF'
Symbols = {
  ["G-Code"] = {
    ["ğŸ‘‡"] = "\n", ["ğŸ‘‰"] = " ", ["âš ï¸"] = "!", ["ğŸ™Œ"] = '"', ["ğŸ¤¬"] = "#", ["ğŸ¤‘"] = "$", ["ğŸ—ï¸"] = "%",
    ["ğŸ«‚"] = "&", ["ğŸ‘"] = "'", ["ğŸŒœ"] = "(", ["ğŸŒ›"] = ")", ["âœ–ï¸"] = "*", ["â•"] = "+", ["ğŸŠ"] = ",",
    ["â–"] = "-", ["ğŸ‘†"] = ".", ["â—"] = "/", ["ğŸ’˜"] = "0", ["ğŸ¤"] = "1", ["ğŸ’™"] = "2", ["ğŸ¤"] = "3",
    ["â¤ï¸"] = "4", ["ğŸ’š"] = "5", ["ğŸ§¡"] = "6", ["ğŸ’œ"] = "7", ["ğŸ’›"] = "8", ["ğŸ–¤"] = "9", ["â†•ï¸ï¸"] = ":",
    ["â†©ï¸"] = ";", ["ğŸŒ˜"] = "<", ["ğŸŒ—"] = "=", ["ğŸŒ–"] = ">", ["â“"] = "?", ["ğŸ…°ï¸"] = "@",
    ["ğŸ˜€"]="A",["ğŸ˜ƒ"]="B",["ğŸ˜„"]="C",["ğŸ˜"]="D",["ğŸ˜†"]="E",["ğŸ˜…"]="F",["ğŸ˜‚"]="G",["ğŸ¤£"]="H",
    ["ğŸ˜­"]="I",["ğŸ˜‰"]="J",["ğŸ˜—"]="K",["ğŸ˜™"]="L",["ğŸ˜š"]="M",["ğŸ˜˜"]="N",["ğŸ¥°"]="O",["ğŸ˜"]="P",
    ["ğŸ¤©"]="Q",["ğŸ¥³"]="R",["ğŸ™ƒ"]="S",["ğŸ™‚"]="T",["ğŸ¥²"]="U",["ğŸ˜Š"]="V",["â˜ºï¸"]="W",["ğŸ˜Œ"]="X",
    ["ğŸ˜"]="Y",["ğŸ¤¤"]="Z",
    ["ğŸ“¬"]="[",["â†˜ï¸"]="\\",["ğŸ“«"]="]",["ğŸ”¼"]="^",["ğŸ”œ"]="_",["â†–ï¸"]="`",
    ["ğŸ˜‹"]="a",["ğŸ˜›"]="b",["ğŸ˜"]="c",["ğŸ˜œ"]="d",["ğŸ¤ª"]="e",["ğŸ¥´"]="f",["ğŸ˜”"]="g",["ğŸ¥º"]="h",
    ["ğŸ˜¬"]="i",["ğŸ˜‘"]="j",["ğŸ˜"]="k",["ğŸ˜¶"]="l",["ğŸ¤"]="m",["ğŸ¤”"]="n",["ğŸ¤«"]="o",["ğŸ¤­"]="p",
    ["ğŸ¥±"]="q",["ğŸ¤—"]="r",["ğŸ˜±"]="s",["ğŸ¤¨"]="t",["ğŸ§"]="u",["ğŸ˜’"]="v",["ğŸ™„"]="w",["ğŸ˜¤"]="x",
    ["ğŸ˜ "]="y",["ğŸ˜¡"]="z",["ğŸ“ˆ"]="{",["ğŸš¦"]="|",["ğŸ“‰"]="}",["ğŸš«"]="~"
  }
}

msg = ...
output = ""
for symbol in msg:gmatch("[\194-\244][\128-\191]*[\128-\191]*") do
  for k,v in pairs(Symbols["G-Code"]) do
    if k == symbol then output = output .. v break end
  end
end
print(output)
EOF
)

LUA_ENCODER=$(cat <<'EOF'
Symbols = {
  ["G-Code"] = {
    ["\n"] = "ğŸ‘‡", [" "] = "ğŸ‘‰", ["!"] = "âš ï¸", ['"'] = "ğŸ™Œ", ["#"] = "ğŸ¤¬", ["$"] = "ğŸ¤‘", ["%"] = "ğŸ—ï¸",
    ["&"] = "ğŸ«‚", ["'"] = "ğŸ‘", ["("] = "ğŸŒœ", [")"] = "ğŸŒ›", ["*"] = "âœ–ï¸", ["+"] = "â•", [","] = "ğŸŠ",
    ["-"] = "â–", ["."] = "ğŸ‘†", ["/"] = "â—", ["0"] = "ğŸ’˜", ["1"] = "ğŸ¤", ["2"] = "ğŸ’™", ["3"] = "ğŸ¤",
    ["4"] = "â¤ï¸", ["5"] = "ğŸ’š", ["6"] = "ğŸ§¡", ["7"] = "ğŸ’œ", ["8"] = "ğŸ’›", ["9"] = "ğŸ–¤", [":"] = "â†•ï¸ï¸",
    [";"] = "â†©ï¸", ["<"] = "ğŸŒ˜", ["="] = "ğŸŒ—", [">"] = "ğŸŒ–", ["?"] = "â“", ["@"] = "ğŸ…°ï¸",
    ["A"]="ğŸ˜€",["B"]="ğŸ˜ƒ",["C"]="ğŸ˜„",["D"]="ğŸ˜",["E"]="ğŸ˜†",["F"]="ğŸ˜…",["G"]="ğŸ˜‚",["H"]="ğŸ¤£",
    ["I"]="ğŸ˜­",["J"]="ğŸ˜‰",["K"]="ğŸ˜—",["L"]="ğŸ˜™",["M"]="ğŸ˜š",["N"]="ğŸ˜˜",["O"]="ğŸ¥°",["P"]="ğŸ˜",
    ["Q"]="ğŸ¤©",["R"]="ğŸ¥³",["S"]="ğŸ™ƒ",["T"]="ğŸ™‚",["U"]="ğŸ¥²",["V"]="ğŸ˜Š",["W"]="â˜ºï¸",["X"]="ğŸ˜Œ",
    ["Y"]="ğŸ˜",["Z"]="ğŸ¤¤",
    ["["]="ğŸ“¬",["\\"]="â†˜ï¸",["]"]="ğŸ“«",["^"]="ğŸ”¼",["_"]="ğŸ”œ",["`"]="â†–ï¸",
    ["a"]="ğŸ˜‹",["b"]="ğŸ˜›",["c"]="ğŸ˜",["d"]="ğŸ˜œ",["e"]="ğŸ¤ª",["f"]="ğŸ¥´",["g"]="ğŸ˜”",["h"]="ğŸ¥º",
    ["i"]="ğŸ˜¬",["j"]="ğŸ˜‘",["k"]="ğŸ˜",["l"]="ğŸ˜¶",["m"]="ğŸ¤",["n"]="ğŸ¤”",["o"]="ğŸ¤«",["p"]="ğŸ¤­",
    ["q"]="ğŸ¥±",["r"]="ğŸ¤—",["s"]="ğŸ˜±",["t"]="ğŸ¤¨",["u"]="ğŸ§",["v"]="ğŸ˜’",["w"]="ğŸ™„",["x"]="ğŸ˜¤",
    ["y"]="ğŸ˜ ",["z"]="ğŸ˜¡",["{"]="ğŸ“ˆ",["|"]="ğŸš¦",["}"]="ğŸ“‰",["~"]="ğŸš«"
  }
}

msg = ...
output = ""
for i=1,#msg do
  c = msg:sub(i,i)
  output = output .. (Symbols["G-Code"][c] or "")
end
print(output)
EOF
)

function encode_text() {
  lua -e "$LUA_ENCODER" "$1"
}

function decode_text() {
  lua -e "$LUA_DECODER" "$1"
}

# === MAIN SCRIPT STARTS ===

if [[ "$1" == "-E" ]]; then
  content=$(cat "$2")
  encode_text "$content"
elif [[ "$1" == "-D" && "$2" == "-F" ]]; then
  content=$(cat "$3")
  decode_text "$content"
elif [[ "$1" == "-D" && "$2" == "-dir" ]]; then
  for f in "$3"/*; do
    [ -f "$f" ] && decode_text "$(cat "$f")"
  done
elif [[ "$1" == "-D" && "$2" == "-A" ]]; then
  find . -type f -exec sh -c 'decode_text "$(cat "$1")"' _ {} \;
else
  echo "[?] Do you want to (E)ncode or (D)ecode?"
  read -r mode
  echo "[?] Enter the text:"
  read -r text
  if [[ "$mode" == "E" || "$mode" == "e" ]]; then
    encode_text "$text"
  else
    decode_text "$text"
  fi
fi
