#!/data/data/com.termux/files/usr/bin/bash

LUA_DECODER=$(cat <<'EOF'
Symbols = {
  ["G-Code"] = {
    ["👇"] = "\n", ["👉"] = " ", ["⚠️"] = "!", ["🙌"] = '"', ["🤬"] = "#", ["🤑"] = "$", ["🗝️"] = "%",
    ["🫂"] = "&", ["👐"] = "'", ["🌜"] = "(", ["🌛"] = ")", ["✖️"] = "*", ["➕"] = "+", ["🐊"] = ",",
    ["➖"] = "-", ["👆"] = ".", ["➗"] = "/", ["💘"] = "0", ["🤎"] = "1", ["💙"] = "2", ["🤍"] = "3",
    ["❤️"] = "4", ["💚"] = "5", ["🧡"] = "6", ["💜"] = "7", ["💛"] = "8", ["🖤"] = "9", ["↕️️"] = ":",
    ["↩️"] = ";", ["🌘"] = "<", ["🌗"] = "=", ["🌖"] = ">", ["❓"] = "?", ["🅰️"] = "@",
    ["😀"]="A",["😃"]="B",["😄"]="C",["😁"]="D",["😆"]="E",["😅"]="F",["😂"]="G",["🤣"]="H",
    ["😭"]="I",["😉"]="J",["😗"]="K",["😙"]="L",["😚"]="M",["😘"]="N",["🥰"]="O",["😍"]="P",
    ["🤩"]="Q",["🥳"]="R",["🙃"]="S",["🙂"]="T",["🥲"]="U",["😊"]="V",["☺️"]="W",["😌"]="X",
    ["😏"]="Y",["🤤"]="Z",
    ["📬"]="[",["↘️"]="\\",["📫"]="]",["🔼"]="^",["🔜"]="_",["↖️"]="`",
    ["😋"]="a",["😛"]="b",["😝"]="c",["😜"]="d",["🤪"]="e",["🥴"]="f",["😔"]="g",["🥺"]="h",
    ["😬"]="i",["😑"]="j",["😐"]="k",["😶"]="l",["🤐"]="m",["🤔"]="n",["🤫"]="o",["🤭"]="p",
    ["🥱"]="q",["🤗"]="r",["😱"]="s",["🤨"]="t",["🧐"]="u",["😒"]="v",["🙄"]="w",["😤"]="x",
    ["😠"]="y",["😡"]="z",["📈"]="{",["🚦"]="|",["📉"]="}",["🚫"]="~"
  }
}

msg = ...
output = ""
for symbol in msg:gmatch("[\194-\244][\128-\191]*[\128-\191]*") do
  for k,v in pairs(Symbols["G-Code"]) do
    if k == symbol then output = output .. v break end
  end
end
print(output)
EOF
)

LUA_ENCODER=$(cat <<'EOF'
Symbols = {
  ["G-Code"] = {
    ["\n"] = "👇", [" "] = "👉", ["!"] = "⚠️", ['"'] = "🙌", ["#"] = "🤬", ["$"] = "🤑", ["%"] = "🗝️",
    ["&"] = "🫂", ["'"] = "👐", ["("] = "🌜", [")"] = "🌛", ["*"] = "✖️", ["+"] = "➕", [","] = "🐊",
    ["-"] = "➖", ["."] = "👆", ["/"] = "➗", ["0"] = "💘", ["1"] = "🤎", ["2"] = "💙", ["3"] = "🤍",
    ["4"] = "❤️", ["5"] = "💚", ["6"] = "🧡", ["7"] = "💜", ["8"] = "💛", ["9"] = "🖤", [":"] = "↕️️",
    [";"] = "↩️", ["<"] = "🌘", ["="] = "🌗", [">"] = "🌖", ["?"] = "❓", ["@"] = "🅰️",
    ["A"]="😀",["B"]="😃",["C"]="😄",["D"]="😁",["E"]="😆",["F"]="😅",["G"]="😂",["H"]="🤣",
    ["I"]="😭",["J"]="😉",["K"]="😗",["L"]="😙",["M"]="😚",["N"]="😘",["O"]="🥰",["P"]="😍",
    ["Q"]="🤩",["R"]="🥳",["S"]="🙃",["T"]="🙂",["U"]="🥲",["V"]="😊",["W"]="☺️",["X"]="😌",
    ["Y"]="😏",["Z"]="🤤",
    ["["]="📬",["\\"]="↘️",["]"]="📫",["^"]="🔼",["_"]="🔜",["`"]="↖️",
    ["a"]="😋",["b"]="😛",["c"]="😝",["d"]="😜",["e"]="🤪",["f"]="🥴",["g"]="😔",["h"]="🥺",
    ["i"]="😬",["j"]="😑",["k"]="😐",["l"]="😶",["m"]="🤐",["n"]="🤔",["o"]="🤫",["p"]="🤭",
    ["q"]="🥱",["r"]="🤗",["s"]="😱",["t"]="🤨",["u"]="🧐",["v"]="😒",["w"]="🙄",["x"]="😤",
    ["y"]="😠",["z"]="😡",["{"]="📈",["|"]="🚦",["}"]="📉",["~"]="🚫"
  }
}

msg = ...
output = ""
for i=1,#msg do
  c = msg:sub(i,i)
  output = output .. (Symbols["G-Code"][c] or "")
end
print(output)
EOF
)

function encode_text() {
  lua -e "$LUA_ENCODER" "$1"
}

function decode_text() {
  lua -e "$LUA_DECODER" "$1"
}

# === MAIN SCRIPT STARTS ===

if [[ "$1" == "-E" ]]; then
  content=$(cat "$2")
  encode_text "$content"
elif [[ "$1" == "-D" && "$2" == "-F" ]]; then
  content=$(cat "$3")
  decode_text "$content"
elif [[ "$1" == "-D" && "$2" == "-dir" ]]; then
  for f in "$3"/*; do
    [ -f "$f" ] && decode_text "$(cat "$f")"
  done
elif [[ "$1" == "-D" && "$2" == "-A" ]]; then
  find . -type f -exec sh -c 'decode_text "$(cat "$1")"' _ {} \;
else
  echo "[?] Do you want to (E)ncode or (D)ecode?"
  read -r mode
  echo "[?] Enter the text:"
  read -r text
  if [[ "$mode" == "E" || "$mode" == "e" ]]; then
    encode_text "$text"
  else
    decode_text "$text"
  fi
fi
